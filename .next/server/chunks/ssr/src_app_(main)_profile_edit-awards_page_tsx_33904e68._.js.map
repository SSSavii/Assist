{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/georgiiisavich/Desktop/assist_plus/src/app/%28main%29/profile/edit-awards/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\n\nexport default function EditAwardsPage() {\n  const [awards, setAwards] = useState('');\n  const [initialAwards, setInitialAwards] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const router = useRouter();\n\n  const awardsRef = useRef(awards);\n  useEffect(() => {\n    awardsRef.current = awards;\n  }, [awards]);\n\n  const handleSave = useCallback(() => {\n    const tg = window.Telegram?.WebApp;\n    if (!tg || !tg.initData) {\n      setError(\"Не удалось получить данные для сохранения.\");\n      return;\n    }\n    \n    tg.offEvent('mainButtonClicked', handleSave);\n    \n    tg.MainButton.showProgress();\n\n    fetch('/api/profile/update-awards', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ initData: tg.initData, awards: awardsRef.current }),\n    })\n    .then(response => {\n      if (!response.ok) throw new Error('Не удалось сохранить достижения');\n      return response.json();\n    })\n    .then(data => {\n      if (data.success) {\n        tg.MainButton.hideProgress();\n        router.push('/profile');\n      } else {\n        throw new Error(data.error || 'Произошла неизвестная ошибка');\n      }\n    })\n    .catch(err => {\n      setError(err.message);\n      tg.MainButton.hideProgress();\n      tg.onEvent('mainButtonClicked', handleSave);\n    });\n  }, [router]);\n\n  useEffect(() => {\n    const tg = window.Telegram?.WebApp;\n    if (tg) {\n      const onBackClick = () => router.back();\n      \n      tg.BackButton.show();\n      tg.MainButton.setText('Сохранить');\n      \n      tg.onEvent('backButtonClicked', onBackClick);\n      tg.onEvent('mainButtonClicked', handleSave);\n\n      fetch('/api/auth', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ initData: tg.initData }),\n      })\n      .then(res => res.json())\n      .then(data => {\n        if (data.awards) {\n          setAwards(data.awards);\n          setInitialAwards(data.awards);\n        }\n      })\n      .catch(() => setError(\"Не удалось загрузить текущие достижения.\"))\n      .finally(() => setLoading(false));\n\n      return () => {\n        tg.MainButton.hideProgress();\n    \n        tg.BackButton.hide();\n        tg.MainButton.hide();\n        tg.offEvent('backButtonClicked', onBackClick);\n        tg.offEvent('mainButtonClicked', handleSave);\n      };\n    }\n  }, [handleSave, router]);\n\n  useEffect(() => {\n    const tg = window.Telegram?.WebApp;\n    if (tg) {\n      if (!tg.MainButton.isProgressVisible) {\n        if (awards !== initialAwards && awards.trim() !== '') {\n          tg.MainButton.show();\n        } else {\n          tg.MainButton.hide();\n        }\n      }\n    }\n  }, [awards, initialAwards]);\n\n  if (loading) {\n    return <div className=\"p-4 text-center text-gray-500\">Загрузка...</div>;\n  }\n\n  return (\n    <div className=\"fixed inset-0 flex flex-col p-4 pt-4 bg-white gap-4 z-10\">\n      <h1 className=\"text-xl font-bold text-black flex-shrink-0\">Ваши достижения</h1>\n      \n      {error && <p className=\"text-red-500 flex-shrink-0\">{error}</p>}\n\n      <textarea\n        value={awards}\n        onChange={(e) => setAwards(e.target.value)}\n        placeholder=\"Расскажите о своих достижениях...\"\n        className=\"w-full flex-grow p-3 bg-gray-100 text-black rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-red-500\"\n      />\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}