{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///Users/georgiiisavich/Desktop/assist_plus/src/lib/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\n\nconst db = new Database('./main.db', { verbose: console.log });\n\nprocess.on('exit', () => db.close());\n\nexport default db;"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,KAAK,IAAI,2HAAA,CAAA,UAAQ,CAAC,aAAa;IAAE,SAAS,QAAQ,GAAG;AAAC;AAE5D,QAAQ,EAAE,CAAC,QAAQ,IAAM,GAAG,KAAK;uCAElB","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///Users/georgiiisavich/Desktop/assist_plus/src/lib/adminAuth.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function withAdminAuth(handler: (request: NextRequest, context: any) => Promise<NextResponse>) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return async (request: NextRequest, context: any) => {\n    const adminSecretKey = process.env.ADMIN_API_SECRET_KEY;\n\n    if (!adminSecretKey) {\n      console.error('CRITICAL: ADMIN_API_SECRET_KEY не установлен в .env.local');\n      return NextResponse.json({ error: 'Ошибка конфигурации сервера' }, { status: 500 });\n    }\n\n    const providedKey = request.headers.get('X-Admin-Secret-Key');\n\n    if (providedKey !== adminSecretKey) {\n      console.warn('Отклонен неавторизованный запрос к админ-API.');\n      return NextResponse.json({ error: 'Доступ запрещен' }, { status: 403 });\n    }\n\n    return handler(request, context);\n  };\n}"],"names":[],"mappings":";;;AAAA;;AAGO,SAAS,cAAc,OAAsE;IAClG,8DAA8D;IAC9D,OAAO,OAAO,SAAsB;QAClC,MAAM,iBAAiB,QAAQ,GAAG,CAAC,oBAAoB;QAEvD,IAAI,CAAC,gBAAgB;YACnB,QAAQ,KAAK,CAAC;YACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,cAAc,QAAQ,OAAO,CAAC,GAAG,CAAC;QAExC,IAAI,gBAAgB,gBAAgB;YAClC,QAAQ,IAAI,CAAC;YACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,OAAO,QAAQ,SAAS;IAC1B;AACF","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/georgiiisavich/Desktop/assist_plus/src/app/api/admin/lots/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport db from 'wxqryy/lib/db';\nimport { withAdminAuth } from 'wxqryy/lib/adminAuth';\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport const GET = withAdminAuth(async (_request: NextRequest) => {\n  try {\n    const lots = db.prepare(`\n      SELECT id, title, status, current_price \n      FROM Lots \n      ORDER BY created_at DESC\n    `).all();\n    return NextResponse.json(lots);\n  } catch (error) {\n    console.error('Ошибка в GET /api/admin/lots:', error);\n    return NextResponse.json({ error: 'Ошибка сервера' }, { status: 500 });\n  }\n});\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport const POST = withAdminAuth(async (request: NextRequest) => {\n  try {\n    const body = await request.json();\n    const { \n      title, \n      start_price, \n      photoUrl, \n      duration_hours, \n      description, \n      city, \n      age \n    } = body;\n\n    if (!title || !start_price || !duration_hours) {\n      return NextResponse.json({ error: 'Отсутствуют обязательные поля: title, start_price, duration_hours' }, { status: 400 });\n    }\n\n    const expiresDate = new Date();\n    expiresDate.setHours(expiresDate.getHours() + duration_hours);\n    const expires_at = expiresDate.toISOString();\n\n    const stmt = db.prepare(`\n      INSERT INTO Lots (\n        title, \n        description, \n        photoUrl, \n        city, \n        age, \n        start_price, \n        current_price, \n        expires_at,\n        status\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, 'ACTIVE')\n    `);\n\n    const result = stmt.run(\n      title, \n      description, \n      photoUrl, \n      city, \n      age, \n      start_price,\n      start_price,\n      expires_at\n    );\n\n    return NextResponse.json({ message: 'Лот успешно создан', lotId: result.lastInsertRowid }, { status: 201 });\n\n  } catch (error) {\n    console.error('Ошибка в POST /api/admin/lots:', error);\n    return NextResponse.json({ error: 'Ошибка сервера при создании лота' }, { status: 500 });\n  }\n});"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGO,MAAM,MAAM,CAAA,GAAA,yHAAA,CAAA,gBAAa,AAAD,EAAE,OAAO;IACtC,IAAI;QACF,MAAM,OAAO,kHAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;;;IAIzB,CAAC,EAAE,GAAG;QACN,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;AACF;AAGO,MAAM,OAAO,CAAA,GAAA,yHAAA,CAAA,gBAAa,AAAD,EAAE,OAAO;IACvC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,KAAK,EACL,WAAW,EACX,QAAQ,EACR,cAAc,EACd,WAAW,EACX,IAAI,EACJ,GAAG,EACJ,GAAG;QAEJ,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,gBAAgB;YAC7C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoE,GAAG;gBAAE,QAAQ;YAAI;QACzH;QAEA,MAAM,cAAc,IAAI;QACxB,YAAY,QAAQ,CAAC,YAAY,QAAQ,KAAK;QAC9C,MAAM,aAAa,YAAY,WAAW;QAE1C,MAAM,OAAO,kHAAA,CAAA,UAAE,CAAC,OAAO,CAAC,CAAC;;;;;;;;;;;;IAYzB,CAAC;QAED,MAAM,SAAS,KAAK,GAAG,CACrB,OACA,aACA,UACA,MACA,KACA,aACA,aACA;QAGF,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAsB,OAAO,OAAO,eAAe;QAAC,GAAG;YAAE,QAAQ;QAAI;IAE3G,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmC,GAAG;YAAE,QAAQ;QAAI;IACxF;AACF","debugId":null}}]
}