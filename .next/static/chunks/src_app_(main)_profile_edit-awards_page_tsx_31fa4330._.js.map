{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/georgiiisavich/Desktop/assist_plus/src/app/%28main%29/profile/edit-awards/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\n\nexport default function EditAwardsPage() {\n  const [awards, setAwards] = useState('');\n  const [initialAwards, setInitialAwards] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const router = useRouter();\n\n  const awardsRef = useRef(awards);\n  useEffect(() => {\n    awardsRef.current = awards;\n  }, [awards]);\n\n  const handleSave = useCallback(() => {\n    const tg = window.Telegram?.WebApp;\n    if (!tg || !tg.initData) {\n      setError(\"Не удалось получить данные для сохранения.\");\n      return;\n    }\n    \n    tg.offEvent('mainButtonClicked', handleSave);\n    \n    tg.MainButton.showProgress();\n\n    fetch('/api/profile/update-awards', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ initData: tg.initData, awards: awardsRef.current }),\n    })\n    .then(response => {\n      if (!response.ok) throw new Error('Не удалось сохранить достижения');\n      return response.json();\n    })\n    .then(data => {\n      if (data.success) {\n        tg.MainButton.hideProgress();\n        router.push('/profile');\n      } else {\n        throw new Error(data.error || 'Произошла неизвестная ошибка');\n      }\n    })\n    .catch(err => {\n      setError(err.message);\n      tg.MainButton.hideProgress();\n      tg.onEvent('mainButtonClicked', handleSave);\n    });\n  }, [router]);\n\n  useEffect(() => {\n    const tg = window.Telegram?.WebApp;\n    if (tg) {\n      const onBackClick = () => router.back();\n      \n      tg.BackButton.show();\n      tg.MainButton.setText('Сохранить');\n      \n      tg.onEvent('backButtonClicked', onBackClick);\n      tg.onEvent('mainButtonClicked', handleSave);\n\n      fetch('/api/auth', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ initData: tg.initData }),\n      })\n      .then(res => res.json())\n      .then(data => {\n        if (data.awards) {\n          setAwards(data.awards);\n          setInitialAwards(data.awards);\n        }\n      })\n      .catch(() => setError(\"Не удалось загрузить текущие достижения.\"))\n      .finally(() => setLoading(false));\n\n      return () => {\n        tg.MainButton.hideProgress();\n    \n        tg.BackButton.hide();\n        tg.MainButton.hide();\n        tg.offEvent('backButtonClicked', onBackClick);\n        tg.offEvent('mainButtonClicked', handleSave);\n      };\n    }\n  }, [handleSave, router]);\n\n  useEffect(() => {\n    const tg = window.Telegram?.WebApp;\n    if (tg) {\n      if (!tg.MainButton.isProgressVisible) {\n        if (awards !== initialAwards && awards.trim() !== '') {\n          tg.MainButton.show();\n        } else {\n          tg.MainButton.hide();\n        }\n      }\n    }\n  }, [awards, initialAwards]);\n\n  if (loading) {\n    return <div className=\"p-4 text-center text-gray-500\">Загрузка...</div>;\n  }\n\n  return (\n    <div className=\"fixed inset-0 flex flex-col p-4 pt-4 bg-white gap-4 z-10\">\n      <h1 className=\"text-xl font-bold text-black flex-shrink-0\">Ваши достижения</h1>\n      \n      {error && <p className=\"text-red-500 flex-shrink-0\">{error}</p>}\n\n      <textarea\n        value={awards}\n        onChange={(e) => setAwards(e.target.value)}\n        placeholder=\"Расскажите о своих достижениях...\"\n        className=\"w-full flex-grow p-3 bg-gray-100 text-black rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-red-500\"\n      />\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}