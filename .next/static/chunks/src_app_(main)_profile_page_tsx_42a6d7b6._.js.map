{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/georgiiisavich/Desktop/assist_plus/src/app/%28main%29/profile/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport {\n  Users,\n  ChevronRight,\n  Medal,\n  UserCircle,\n  Pencil,\n  Wallet,\n  Gift,\n  Calendar,\n} from 'lucide-react';\n\ntype UserProfile = {\n  id: number;\n  first_name: string;\n  last_name?: string;\n  username?: string;\n  photo_url?: string;\n  balance_crystals: number;\n};\n\ninterface Winning {\n  id: number;\n  prize_name: string;\n  won_at: string;\n  prize_type: string;\n}\n\ninterface ProfileLinkProps {\n  icon: React.ElementType;\n  iconBgColor: string;\n  text: string;\n  subText?: string;\n  href: string;\n}\n\nfunction ProfileLink({ icon: Icon, iconBgColor, text, subText, href }: ProfileLinkProps) {\n  return (\n    <Link\n      href={href}\n      className=\"flex items-center w-full p-3 bg-gray-100 rounded-lg transition-colors hover:bg-gray-200 active:bg-gray-300\"\n    >\n      <div className={`p-2 rounded-md ${iconBgColor}`}>\n        <Icon className=\"h-5 w-5 text-white\" />\n      </div>\n      <span className=\"ml-4 font-semibold flex-grow\">{text}</span>\n      {subText && <span className=\"text-gray-500 mr-2\">{subText}</span>}\n      <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n    </Link>\n  );\n}\n\ninterface BalanceDisplayProps {\n    icon: React.ElementType;\n    iconBgColor: string;\n    text: string;\n    balance: number;\n}\n\nfunction BalanceDisplay({ icon: Icon, iconBgColor, text, balance }: BalanceDisplayProps) {\n    return (\n        <div className=\"flex items-center w-full p-3 bg-gray-100 rounded-lg\">\n            <div className={`p-2 rounded-md ${iconBgColor}`}>\n                <Icon className=\"h-5 w-5 text-white\" />\n            </div>\n            <span className=\"ml-4 font-semibold flex-grow\">{text}</span>\n            <span className=\"font-bold text-lg\">{balance.toLocaleString('ru-RU')}</span>\n        </div>\n    );\n}\n\nexport default function ProfilePage() {\n  const [user, setUser] = useState<UserProfile | null>(null);\n  const [winnings, setWinnings] = useState<Winning[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [winningsLoading, setWinningsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const tg = window.Telegram?.WebApp;\n    if (tg) {\n      tg.ready();\n      fetch('/api/auth', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ initData: tg.initData }),\n      })\n      .then(response => {\n        if (!response.ok) throw new Error('Не удалось загрузить данные пользователя');\n        return response.json();\n      })\n      .then(data => {\n        if (data && data.error) {\n            throw new Error(data.error);\n        }\n        const fullUserData = {\n            ...data,\n            photo_url: tg.initDataUnsafe?.user?.photo_url,\n        };\n        setUser(fullUserData);\n        \n        // Загружаем историю выигрышей после загрузки профиля\n        setWinningsLoading(true);\n        return fetch('/api/user/winnings', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ initData: tg.initData }),\n        });\n      })\n      .then(response => {\n        if (!response.ok) throw new Error('Не удалось загрузить историю выигрышей');\n        return response.json();\n      })\n      .then(winningsData => {\n        setWinnings(winningsData);\n      })\n      .catch(err => {\n        console.error(\"Profile fetch error:\", err);\n        setError(err.message);\n      })\n      .finally(() => {\n        setLoading(false);\n        setWinningsLoading(false);\n      });\n    } else {\n        setLoading(false);\n        setError(\"Приложение необходимо открыть в Telegram\");\n    }\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-full bg-white\">\n        <p className=\"text-gray-500\">Загрузка данных профиля...</p>\n      </div>\n    );\n  }\n\n  if (error || !user) {\n      return (\n        <div className=\"flex justify-center items-center h-full bg-white\">\n            <p className=\"text-red-500\">{error || \"Не удалось загрузить профиль.\"}</p>\n        </div>\n      );\n  }\n\n  return (\n    <div className=\"flex flex-col items-center bg-white text-black p-4 pt-8 pb-20\">\n      <div className=\"flex flex-col items-center\">\n        {user.photo_url ? (\n          <Image\n            src={user.photo_url}\n            alt=\"User Avatar\"\n            width={150}\n            height={150}\n            className=\"rounded-full\"\n          />\n        ) : (\n          <UserCircle className=\"h-24 w-24 text-gray-300\" />\n        )}\n        <h2 className=\"text-2xl font-bold mt-4\">\n          {user.first_name} {user.last_name || ''}\n        </h2>\n      </div>\n\n      <div className=\"w-full max-w-md mt-10 space-y-3\">\n        <BalanceDisplay \n            icon={Wallet}\n            iconBgColor=\"bg-green-500\"\n            text=\"Баланс\"\n            balance={user.balance_crystals}\n        />\n\n        <ProfileLink\n          icon={Pencil}\n          iconBgColor=\"bg-blue-500\"\n          text=\"Добавить описание\"\n          href=\"/profile/edit-bio\"\n        />\n\n        <ProfileLink\n          icon={Medal}\n          iconBgColor=\"bg-purple-500\"\n          text=\"Добавить достижения\"\n          href=\"/profile/edit-awards\"\n        />\n\n        <ProfileLink\n          icon={Users}\n          iconBgColor=\"bg-orange-500\"\n          text=\"Сообщество Assist+\"\n          href=\"\"\n        />\n      </div>\n\n      {/* Раздел истории выигрышей */}\n      <div className=\"w-full max-w-md mt-8\">\n        <div className=\"flex items-center mb-4\">\n          <Gift className=\"h-6 w-6 text-red-500 mr-2\" />\n          <h3 className=\"text-xl font-bold\">История выигрышей</h3>\n        </div>\n\n        {winningsLoading ? (\n          <div className=\"text-center py-4\">\n            <p className=\"text-gray-500\">Загрузка истории...</p>\n          </div>\n        ) : winnings.length > 0 ? (\n          <div className=\"space-y-3\">\n            {winnings.map((winning) => (\n              <div key={winning.id} className=\"bg-gray-50 rounded-lg p-4 border border-gray-200\">\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <h4 className=\"font-semibold text-gray-800\">{winning.prize_name}</h4>\n                    <div className=\"flex items-center mt-1 text-sm text-gray-500\">\n                      <Calendar className=\"h-4 w-4 mr-1\" />\n                      <span>\n                        {new Date(winning.won_at).toLocaleDateString('ru-RU', {\n                          day: 'numeric',\n                          month: 'long',\n                          year: 'numeric'\n                        })}\n                      </span>\n                    </div>\n                  </div>\n                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                    winning.prize_type === 'rare' \n                      ? 'bg-purple-100 text-purple-800' \n                      : 'bg-blue-100 text-blue-800'\n                  }`}>\n                    {winning.prize_type === 'rare' ? 'Редкий приз' : 'Обычный приз'}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-6 bg-gray-50 rounded-lg border border-gray-200\">\n            <Gift className=\"h-12 w-12 text-gray-300 mx-auto mb-2\" />\n            <p className=\"text-gray-500\">У вас пока нет выигрышей</p>\n            <p className=\"text-sm text-gray-400 mt-1\">Испытайте удачу в магазине!</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}